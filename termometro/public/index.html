<!DOCTYPE html>
<html>
<head>
  <title>Temperatura - Nodo1</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 8px;
    }
  </style>
</head>
<body>
  <h1>Temperatura nodo1</h1>
  <h2 id="media"></h2>

  <table>
    <thead>
      <tr>
        <th>Temperatura</th>
        <th>Fecha</th>
      </tr>
    </thead>
    <tbody id="tabla">
    </tbody>
  </table>

  <script>
    function actualizar() {
      fetch("/temperatura/nodo1")
        .then(r => r.json())
        .then(data => {
          document.getElementById("media").innerText = `Media de últimas 5: ${data.media} °C`;

          let tabla = document.getElementById("tabla");
          tabla.innerHTML = "";
          data.ultimas.forEach(row => {
            const tr = document.createElement("tr");
            const celdaTemp = `<td>${row.temperatura}</td>`;
            const fecha = new Date(row.timestamp).toLocaleString();
            const celdaFecha = `<td>${fecha}</td>`;
            tr.innerHTML = celdaTemp + celdaFecha;
            tabla.appendChild(tr);
          });
        });
    }

    setInterval(actualizar, 60000); // 60s
    actualizar();
  </script>
</body>
</html>
